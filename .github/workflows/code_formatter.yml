name: Code Formatter

on:
  push:
    branches:
      - main
    paths:
      - '**/*.py'
      - '.github/workflows/code_formatter.yml'

jobs:
  format_code:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.ref_name }}

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install ruff

      - name: Run Ruff Linter (with auto-fix)
        run: ruff check $(git ls-files '*.py') --fix --target-version py310 --select ALL --no-preview || true

      - name: Run Ruff Formatter
        run: ruff format $(git ls-files '*.py') --target-version py310 --line-length 360 --no-preview || true

      - name: Check for changes
        id: changes
        run: |
          if git diff --quiet; then
            echo "has_changes=false" >> "$GITHUB_OUTPUT"
          else
            echo "has_changes=true" >> "$GITHUB_OUTPUT"
          fi

      - name: Create Pull Request
        if: steps.changes.outputs.has_changes == 'true'
        uses: peter-evans/create-pull-request@v7
        with:
          commit-message: "style(ruff): –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞"
          title: "üé® –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞"
          body: |
            –≠—Ç–æ—Ç Pull Request –±—ã–ª —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ GitHub Actions –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –µ–¥–∏–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∫–æ–¥–∞.

            üîß –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Å –ø–æ–º–æ—â—å—é [`Ruff`](https://github.com/astral-sh/ruff):
            > - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª—è –∏ –ª–∏–Ω—Ç–∏–Ω–≥–∞ (`ruff check --fix`)
            > - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∞ (`ruff format`)

            ‚ú® –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∏–ª—å –∫–æ–¥–∞, –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞.
            > –¶–µ–ª–µ–≤–∞—è –≤–µ—Ä—Å–∏—è Python: **3.10**
          branch: "formatter/${{ github.ref_name }}"
          delete-branch: true
